# Epic 2 Retrospective — Calculation Engine
**Date:** 2026-02-27
**Scope:** Epic 2 — Stories 2.1 and 2.2
**Facilitator:** Bob (SM)
**Participants:** Bob (SM), Amelia (Dev), Winston (Architect), John (PM), Quinn (QA)

---

## Epic Summary

Epic 2 built the full calculation engine: a 5-phase state machine for number entry and operator selection (Story 2.1), then equation completion, arithmetic calculation, animated answer display, and chained calculations (Story 2.2). Both stories are fully documented and verified.

| Story | Status | Key Deliverable |
|---|---|---|
| 2.1 — State Machine, Number Entry & Operator Selection | review | Full `dispatch()` + `render()` implementation for `idle/first/operator` phases; delegated click listener; keyboard listener; state helper functions |
| 2.2 — Equation Completion, Calculation & Animated Answer | review | `calculate()` pure function; `second/result` phase handlers; PRESS_EQUALS with shake-on-incomplete; `.is-animating` animation; chained calculation support |

---

## What Went Well

- **State machine design was clean.** Five phases (`idle`, `first`, `operator`, `second`, `result`), one `dispatch()`, one `render()`. The mental model was consistent throughout. Every feature fell out naturally from the phase transitions.
- **`calculate()` is pure.** No DOM access, no state mutation. This made the Story 4.3 test suite trivially easy — test the pure function directly with DOM stubs. Architecture enforced this from the start and it paid off.
- **Chained calculations (AC 8).** After seeing a result, tapping an operator continues the chain rather than forcing a reset. Correct UX for how children actually use calculators. Specified and implemented correctly.
- **PRESS_EQUALS shake-on-incomplete.** The one case where `render()` is NOT called after dispatch — a deliberate exception. The `{ once: true }` `animationend` listener correctly cleans up the `.is-shake` class without leaking handlers.
- **Unicode consistency.** `−` (U+2212), `×`, `÷` used consistently across HTML `data-value` attributes, keyboard listener mappings, and `calculate()` operator comparisons. All 18 test assertions implicitly verified this.
- **All tasks checked, Dev Agent Records complete** for both stories.

---

## What Didn't Go Well

- **Division result precision not discussed.** `1 ÷ 3` returns `0.3333333333333333` — 16 decimal places. The spec says "no rounding" and the implementation is correct per spec. But this was never surfaced as a UX trade-off for a grade 3 audience. A child seeing 16 decimal places is unexpected. This is a known behaviour, not a defect — but it should have been an explicit product decision.
- **`dispatch()` grew to ~40 lines by end of Story 2.2.** Still readable, but verbose. For this project scale it's fine. If the project were extended, extracting per-phase handlers into named functions would be worth considering.

---

## Action Items

| # | Action | Owner | When |
|---|---|---|---|
| B1 | If project is extended: document expected division precision behaviour in PRD or architecture notes | John (PM) | If extended |
| B2 | If project is extended: consider extracting per-phase handlers from `dispatch()` | Amelia (Dev) | If extended |

---

## Readiness Assessment

Both stories fully documented and verified. Epic 2 delivered a correct, tested calculation engine. The `calculate()` pure function passes all 18 Story 4.3 test assertions.

**Epic 2 status: COMPLETE**
